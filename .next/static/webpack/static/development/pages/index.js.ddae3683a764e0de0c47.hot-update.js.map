{"version":3,"file":"static/webpack/static/development/pages/index.js.ddae3683a764e0de0c47.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import React from 'react';\nimport socketIo from 'socket.io-client';\nimport { Button } from 'antd';\nimport styled from 'styled-components';\nimport { inject, observer } from \"mobx-react\";\nimport Selecter from '../Components/Selecter';\nimport Uploader from '../Components/Upload';\nimport History from '../Components/History';\nimport Steper from '../Components/Steper';\nimport MSGScreen from '../Components/MSGScreen';\n\nconst socket = socketIo('http://localhost:3001');\n\nconst Row = styled.div`\n  display: flex;\n`;\n\nconst PackContent = styled.div`\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  margin-left: 100px;\n`;\n\n\n@inject(({store}) => {\n  return ({\n    basicUrl: store.basicUrl,\n    updateAvailableList: store.updateAvailableList,\n    updateUrls: store.updateUrls,\n    step: store.step,\n    updateStep: store.updateStep,\n    targetVersion: store.targetVersion,\n    availableList: store.availableList,\n    targetUrl: store.targetUrl,\n    updateTargetUrl: store.updateTargetUrl,\n    updateStepStatus: store.updateStepStatus,\n    addPackMsg: store.addPackMsg\n  })\n})\n\n@observer class Packager extends React.Component {\n  state = {\n    btnPackDisabled: true,\n    btnDownDisabled: true,\n  };\n\n  componentDidMount() {\n    const { basicUrl, updateStep, updateTargetUrl, updateUrls, updateStepStatus } = this.props;\n\n    // 开始打包\n    socket.on('pack', (res) => {\n      console.log('pack', res);\n      if (!res.url) {\n        updateStepStatus('error');\n        return;\n      }\n      updateStep(4);\n      updateTargetUrl(res.url);\n      updateUrls(res.list);\n      updateStepStatus('finish')\n    });\n\n    // 打包日志\n    socket.on('packMsg', (data) => {\n      console.log(data.msg, 'packMsg')\n      this.props.addPackMsg(data.msg);\n    });\n\n    // 获取可打包项\n    fetch(`${basicUrl}/getAvailable`)\n      .then(res => res.json())\n      .then(res => {\n        this.props.updateAvailableList(res)\n      });\n\n    // 获取可下载项目\n    fetch(`${basicUrl}/getUrls`)\n      .then(res => res.json())\n      .then(res => {\n        this.props.updateUrls(res)\n      });\n  }\n\n  pack = () => {\n    const { updateStep, availableList, targetVersion, updateStepStatus } = this.props;\n    updateStep(3);\n    updateStepStatus('process');\n    socket.emit('pack', {version: targetVersion || availableList[0]});\n  };\n\n  stopPack = () => {\n    socket.emit('stopPack');\n  };\n\n  render() {\n    const { step } = this.props;\n    return (\n      <div style={{padding: 100}}>\n        <Row>\n          <Steper />\n          <PackContent>\n            <Selecter style={{height: 100}} />\n            <Uploader style={{height: 200}} />\n            <div className=\"centerRow\" style={{height: 100}}>\n              <Button disabled={(step === 3)} type=\"primary\" size=\"large\" onClick={this.pack} style={{}}>\n                开始\n              </Button>\n              <Button disabled={(step !== 3)} type=\"primary\" size=\"large\" onClick={this.stopPack}>停止</Button>\n            </div>\n            <MSGScreen style={{height: 200}} />\n            <a className=\"centerRow\" href={this.props.targetUrl}>\n              <Button disabled={(step < 4)} type=\"primary\" icon=\"download\" size=\"large\">\n                  下载\n              </Button>\n            </a>\n          </PackContent>\n        </Row>\n        <History style={{marginTop: 40}} />\n      </div>\n    )\n  }\n}\n\nexport default Packager;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAwBA;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;;;;;;;;;;;;;;;;;AAGA;AACA;AACA;AAFA;AACA;AAyCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AA/CA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;;;AAaA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAGA;;;;AAhFA;AAmFA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}